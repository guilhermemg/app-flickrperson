<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<!-- Le styles -->
<link
        href="http://pybossa.socientize.eu/pybossa/static/vendor/bootstrap.min.css"
        rel="stylesheet" type="text/css">
<link
        href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css"
        rel="stylesheet">
<link
        href="http://pybossa.socientize.eu/pybossa/static/css/fonts/stylesheet.css"
        rel="stylesheet">
<link href="http://pybossa.socientize.eu/pybossa/static/css/styles.css"
        rel="stylesheet"> 

<!-- Le javascript -->
<script type="text/javascript"
        src="http://pybossa.socientize.eu/pybossa/static/vendor/jquery.js"></script>
<style type="text/css"></style>
<script type="text/javascript"
        src="http://pybossa.socientize.eu/pybossa/static/vendor/bootstrap/2.2.1/js/bootstrap.js"></script>

<script src="http://localhost/pybossa/static/js/pybossa/pybossa.js"
        type="text/javascript"></script>

<style type="text/css">

.container {
	width: 940px;
}

#task-template {
	min-height: 700px;
}

#task-long-description {
	min-height: 700px;
}

</style>

</head>
<body>
    <header>
	    <div class="navbar navbar-fixed-top">
	            <div class="navbar-inner">
	                    <div class="container">
	                            <a class="btn btn-navbar" data-toggle="collapse"
	                                    data-target=".nav-collapse"> <span class="icon-bar"></span> <span
	                                    class="icon-bar"></span> <span class="icon-bar"></span>
	                            </a> <a class="brand" href="http://www.socientize.eu/"><img
	                                    src="http://pybossa.socientize.eu/pybossa/static/img/logo_societic.png"
	                                    alt="Socientize"></a>
	                    </div>
	            </div>
	    </div>
    </header>
	
	<div id="task-long-description" class="container">
		<div id="long-description-info">
			<a class="btn btn-primary pull-right" onclick="showTaskTemplate()"><i class="icon-thumbs-up" style="color:white;"></i> Start Contributing Now!</a>
		</div>
		<div id="long-description-content"></div>
	</div>
	
	<div id="task-template" class="container" style="display: none;"></div>
	<div id="task-tutorial" class="container"></div>

	<footer>
		<div class="container">
			<div class="row">
				<div class="span3">
					<a href="http://ec.europa.eu/"><img
						src="http://pybossa.socientize.eu/pybossa/static/img/commlogo.jpg"></a>
				</div>
				<div class="span3">
					<a href="http://cordis.europa.eu/fp7/home_en.html"><img
						src="http://pybossa.socientize.eu/pybossa/static/img/fp7logo.jpg"></a>
				</div>
				<div class="span3">
					<a href="http://europa.eu/"><img
						src="http://pybossa.socientize.eu/pybossa/static/img/eulogo.jpg"></a>
				</div>
				<div class="span3">
					<a href="http://pybossa.com/"><img
						src="http://pybossa.socientize.eu/pybossa/static/img/pybossa.png"></a>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript" charset="utf-8">
	
		var task_shortname = "flickrperson";
		var endpoint = "/pybossa";
		var numOfTaskRunDone = 0;
		
		$("#task-template").load("template.html", function() {
			console.log("Task template carregado");
		});
		
		$("#long-description-content").load("long_description.html", function() {
			console.log("Long description carregado");
		});
		
		function FinishedTaskCallback() {
		}
		FinishedTaskCallback.prototype.finished = function() {
			// Load a new task
			pybossa.newTask(task_shortname).done(function(data) {
				loadData(data, new FinishedTaskCallback());
			});
		}
		
		function checkUserProgress() {
		    pybossa.userProgress(task_shortname).done(function(data){
		    	numOfTaskRunDone = data.done;
		    });
		}
		
		function loadTutorial() {
			$("#task-tutorial").load("tutorial.html", function() {
				console.log("Tutorial carregado");
			});
		}
		
		function showTaskTemplate() {
			if (numOfTaskRunDone == 0) {
				loadTutorial();
			}
			$("#task-template").show();	
			$("#task-long-description").hide();
		}
	</script>

	<!--Facebook Login Code-->
	<div id="fb-root"></div>
	<script type="text/javascript" charset="utf-8">

		var successfullyLogged = false;
		var permissions = {scope: 'email'};

		window.fbAsyncInit = function() {
			FB.init({
				appId : '549612841794811',
				status : false, // check login status
				cookie : true, // enable cookies to allow the server to access the session
				xfbml : true
			});

			FB.getLoginStatus(handleAuthChange);
		};

		// Load the SDK asynchronously
		(function(d) {
			var js, id = 'facebook-jssdk', ref = d
					.getElementsByTagName('script')[0];
			if (d.getElementById(id)) {
				return;
			}
			js = d.createElement('script');
			js.id = id;
			js.async = true;
			js.src = "//connect.facebook.net/en_US/all.js";
			ref.parentNode.insertBefore(js, ref);
		}(document));

		function handleAuthChange(response) {
			if (response.status === 'connected' && !successfullyLogged) {
				processLogin(response.authResponse);
			} else if (response.status === 'not_authorized') {
				FB.login(handleAuthChange, permissions);
			} else {
				FB.login(handleAuthChange, permissions);
			}
		}

		function processLogin(authResponse) {
			console.log(authResponse);
			$.ajax({
				url : "https://graph.facebook.com/me?access_token=" + authResponse.accessToken,
				dataType : 'json'
			}).pipe(function (response) {
				var authData = {
					'facebook_user_id' : response.id,
					'email' : response.email,
					'name' : response.name
				};

				pybossa.authenticateUser(authData, function(answer) {
					successfullyLogged = true;
					FB.Event.subscribe('auth.authResponseChange', handleAuthChange);
					
					checkUserProgress();

					// Show PyBossa Task
					pybossa.newTask(task_shortname).done(function(data) {
						loadData(data, new FinishedTaskCallback());
						$("#task-content").show();
					});
				});
			});
		}
	</script>
</body>
</html>
